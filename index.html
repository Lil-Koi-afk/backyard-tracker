<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Backyard Ultra Tracker</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BYU Tracker">
<meta name="theme-color" content="#0a0a0a">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:#0a0a0a;color:#fff;overscroll-behavior:none}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:4px}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
@keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
.shake{animation:shake .4s ease}.pop{animation:pop .3s ease}
button{border:none;cursor:pointer;font-family:inherit}
.card{transition:all .2s ease}.card:active{transform:scale(.985)}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-60px);background:#1a1a1a;color:#fff;padding:12px 24px;border-radius:14px;font-size:13px;opacity:0;transition:all .4s cubic-bezier(.2,1,.3,1);z-index:999;pointer-events:none;border:1px solid rgba(255,255,255,.08);display:flex;align-items:center;gap:8px}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.success{border-color:rgba(16,185,129,.3)}.toast.error{border-color:rgba(239,68,68,.3)}
.sync-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.sync-dot.online{background:#10b981}.sync-dot.offline{background:#ef4444}.sync-dot.syncing{background:#f59e0b;animation:pop 1s infinite}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback}=React;

// ============================================================
// FIREBASE CONFIG ‚Äî Trage hier deine Firebase URL ein:
// ============================================================
const FIREBASE_URL = "https://backyard-tracker-default-rtdb.europe-west1.firebasedatabase.app";
// Beispiel: "https://backyard-tracker-abc12-default-rtdb.europe-west1.firebasedatabase.app"
// ============================================================

const DB_PATH = "/tracker/progress.json";
const PASSWORD = "2808";

async function cloudSave(data) {
  if (!FIREBASE_URL || FIREBASE_URL.includes("DEINE_FIREBASE")) return false;
  try {
    const res = await fetch(FIREBASE_URL + DB_PATH, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    return res.ok;
  } catch { return false; }
}

async function cloudLoad() {
  if (!FIREBASE_URL || FIREBASE_URL.includes("DEINE_FIREBASE")) return null;
  try {
    const res = await fetch(FIREBASE_URL + DB_PATH);
    if (!res.ok) return null;
    const data = await res.json();
    return data || {};
  } catch { return null; }
}

const PLAN=[
  {week:1,dateRange:"07.02 ‚Äì 08.02",goal:"Einstieg, Puls beruhigen, Rhythmus finden",days:[
    {date:"2026-02-07",day:"Sa",unit:"Long Run",dauer:"1:45‚Äì2:15 h",zone:"Zone 2",type:"run",fokus:"Sehr locker. Gehpausen erlaubt.",detail:"Dein allererster Lauf im Plan. Das Ziel ist NICHT Tempo, sondern deinen K√∂rper an l√§ngere Belastung zu gew√∂hnen. Du kommst von 5 km Sprints ‚Äî dein K√∂rper muss lernen, im aeroben Bereich zu bleiben. Lauf so langsam, dass du dich dabei unterhalten k√∂nntest. Gehpausen sind absolut erlaubt und sogar erw√ºnscht. Achte auf deine Atmung: gleichm√§√üig, durch die Nase wenn m√∂glich."},
    {date:"2026-02-08",day:"So",unit:"Recovery Run",dauer:"30‚Äì40 min",zone:"Zone 2",type:"run",fokus:"Optional. Sehr locker oder komplett frei.",detail:"Optional! Wenn deine Beine sich gut anf√ºhlen, mach einen ultra-lockeren Lauf. Wenn nicht, nimm dir frei. Der Sinn ist, den K√∂rper an Bewegung am Folgetag zu gew√∂hnen ‚Äî genau wie beim Backyard Ultra, wo du nach jeder Runde wieder raus musst."},
  ]},
  {week:2,dateRange:"09.02 ‚Äì 15.02",goal:"Grundlagenausdauer & Struktur aufbauen",days:[
    {date:"2026-02-09",day:"Mo",unit:"Gym ‚Äî Push Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Oberk√∂rper. Keine schwere Beinbelastung.",detail:"Normaler Push Day, aber ab jetzt gilt: keine schweren Squats oder Beinpresse. Deine Beine brauchen die Kapazit√§t f√ºrs Laufen. Fokus auf Brust, Schultern, Trizeps. Core-Arbeit ist goldwert ‚Äî Planks, Pallof Press, etc."},
    {date:"2026-02-10",day:"Di",unit:"Dauerlauf",dauer:"60 min",zone:"Zone 2",type:"run",fokus:"Locker, gleichm√§√üig, Gespr√§ch m√∂glich.",detail:"60 Minuten am St√ºck in Zone 2. Das ist dein Brot-und-Butter-Lauf. Zone 2 bedeutet: du k√∂nntest dabei reden, ohne au√üer Atem zu kommen. Dein Herz-Kreislauf-System baut hier die Basis auf."},
    {date:"2026-02-11",day:"Mi",unit:"Gym ‚Äî Pull Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"R√ºcken & Core.",detail:"Pull Day mit Fokus auf R√ºcken und Core. Dein R√ºcken muss dich 24 Stunden aufrecht halten. Deadlifts nur leicht, Rows, Klimmz√ºge, und unbedingt Core-Stabilit√§t."},
    {date:"2026-02-12",day:"Do",unit:"Tempolauf",dauer:"45‚Äì55 min",zone:"Zone 2‚Äì3",type:"tempo",fokus:"Letzte 10 min kontrolliert z√ºgig.",detail:"Starte 35‚Äì45 min in Zone 2, dann steigere die letzten 10 Minuten in Zone 3. Das trainiert deinen K√∂rper, auch unter leichter Erm√ºdung noch Tempo halten zu k√∂nnen."},
    {date:"2026-02-13",day:"Fr",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Regeneration.",detail:"Komplette Pause. Dein K√∂rper wird st√§rker in der Erholung, nicht im Training. Schlaf mindestens 7‚Äì8 Stunden, trinke genug, iss proteinreich."},
    {date:"2026-02-14",day:"Sa",unit:"Long Run",dauer:"2:00 h",zone:"Zone 2",type:"longrun",fokus:"Zeit auf den Beinen. Ern√§hrung testen.",detail:"2 Stunden in Zone 2. Teste hier schon mal deine Verpflegung. Was isst du vor dem Lauf? Was nimmst du mit? Finde jetzt raus, was dein Magen vertr√§gt."},
    {date:"2026-02-15",day:"So",unit:"Lockerer Lauf",dauer:"40 min",zone:"Zone 2",type:"run",fokus:"M√ºde Beine akzeptieren.",detail:"Deine Beine werden sich schwer anf√ºhlen nach gestern. Das ist gewollt! Diesen Lauf machst du trotzdem ‚Äî ultra-locker."},
  ]},
  {week:3,dateRange:"16.02 ‚Äì 22.02",goal:"Erm√ºdungsresistenz aufbauen",days:[
    {date:"2026-02-16",day:"Mo",unit:"Gym ‚Äî Push Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Oberk√∂rper.",detail:"Push Day wie gewohnt. Halte das Volumen moderat ‚Äî du brauchst Energie f√ºr die Laufwoche. Core nicht vergessen!"},
    {date:"2026-02-17",day:"Di",unit:"Dauerlauf",dauer:"70 min",zone:"Zone 2",type:"run",fokus:"Ruhig. Puls kontrollieren.",detail:"10 Minuten mehr als letzte Woche. Dein aerober Motor wird effizienter. Achte darauf, dass dein Puls wirklich in Zone 2 bleibt."},
    {date:"2026-02-18",day:"Mi",unit:"Gym ‚Äî Pull Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Core-Stabilit√§t.",detail:"Pull Day. Fokus: Core-Stabilit√§t wird jetzt wichtiger. Dein Rumpf muss dich √ºber 160 km tragen."},
    {date:"2026-02-19",day:"Do",unit:"Tempolauf",dauer:"60 min",zone:"Zone 3",type:"tempo",fokus:"4√ó6 min z√ºgig, 2 min locker.",detail:"Intervalle! 15 min Einlaufen in Zone 2. Dann 4 Bl√∂cke √† 6 Minuten in Zone 3 mit je 2 Minuten lockerem Joggen dazwischen. Das steigert deine Laktatschwelle."},
    {date:"2026-02-20",day:"Fr",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Regeneration.",detail:"Pause. Schlaf ist King."},
    {date:"2026-02-21",day:"Sa",unit:"Long Run",dauer:"2:45 h",zone:"Zone 2",type:"longrun",fokus:"Monoton laufen. Mentaltraining.",detail:"Fast 3 Stunden! Hier geht's um den Kopf. Lauf eine langweilige Strecke. Kein Podcast. Keine Ablenkung. Lerne, mit der Monotonie umzugehen."},
    {date:"2026-02-22",day:"So",unit:"Lockerer Lauf",dauer:"45 min",zone:"Zone 2",type:"run",fokus:"Sehr entspannt.",detail:"Recovery. Maximal locker. Wenn du dich schlecht f√ºhlst, mach nur 30 min oder lass es ganz."},
  ]},
  {week:4,dateRange:"23.02 ‚Äì 01.03",goal:"Zeit auf den Beinen maximieren",days:[
    {date:"2026-02-23",day:"Mo",unit:"Gym ‚Äî Push Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Leicht.",detail:"Push Day, aber jetzt leichter als gewohnt. Weniger Gewicht, gleiche Technik."},
    {date:"2026-02-24",day:"Di",unit:"Dauerlauf",dauer:"75 min",zone:"Zone 2",type:"run",fokus:"Locker.",detail:"75 Minuten in Zone 2. Dein aerober Motor ist jetzt deutlich besser als vor 2 Wochen."},
    {date:"2026-02-25",day:"Mi",unit:"Gym ‚Äî Pull Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Stabilit√§t.",detail:"Pull Day mit Fokus auf Stabilit√§t. Halte das Gym-Training supportiv, nicht zerst√∂rerisch."},
    {date:"2026-02-26",day:"Do",unit:"Tempolauf",dauer:"65 min",zone:"Zone 3",type:"tempo",fokus:"3√ó10 min z√ºgig.",detail:"L√§ngere Tempo-Bl√∂cke: 3√ó10 min in Zone 3 mit je 3 min Pause."},
    {date:"2026-02-27",day:"Fr",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Regeneration.",detail:"Pause. Schlaf, Ern√§hrung, Hydration."},
    {date:"2026-02-28",day:"Sa",unit:"Long Run",dauer:"3:30 h",zone:"Zone 2",type:"longrun",fokus:"Essen, Trinken, Rhythmus.",detail:"3,5 Stunden. Das ist dein l√§ngster Lauf bisher. Teste ALLES: Schuhe, Socken, Ern√§hrung, Trinken. Bedenke: auf Teneriffa ist es warm ‚Äî in England wird es kalt sein."},
    {date:"2026-03-01",day:"So",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Komplette Erholung.",detail:"Komplette Pause. Beine hoch, gut essen, viel schlafen."},
  ]},
  {week:5,dateRange:"02.03 ‚Äì 08.03",goal:"Peak Belastung ‚Äî h√§rteste Woche",days:[
    {date:"2026-03-02",day:"Mo",unit:"Gym ‚Äî Push Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Sehr leicht.",detail:"Sehr leichtes Gym. Ab jetzt nur noch Maintenance."},
    {date:"2026-03-03",day:"Di",unit:"Dauerlauf",dauer:"60 min",zone:"Zone 2",type:"run",fokus:"Locker.",detail:"Bewusst k√ºrzer als letzte Woche. Vorbereitung auf den Key Run."},
    {date:"2026-03-04",day:"Mi",unit:"Gym ‚Äî Pull Day",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Leicht.",detail:"Leichter Pull Day. Letzte richtige Gym-Woche vor dem Taper."},
    {date:"2026-03-05",day:"Do",unit:"Fast Finish Run",dauer:"70 min",zone:"Zone 2‚Äì3",type:"tempo",fokus:"Letzte 20 min z√ºgig.",detail:"50 min locker in Zone 2, dann die letzten 20 min in Zone 3. Das simuliert Erm√ºdung."},
    {date:"2026-03-06",day:"Fr",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Regeneration.",detail:"Wichtige Pause vor dem l√§ngsten Lauf des Plans."},
    {date:"2026-03-07",day:"Sa",unit:"Key Run",dauer:"4:00‚Äì4:30 h",zone:"Zone 2",type:"longrun",fokus:"L√§ngster Lauf + Verpflegung testen.",detail:"DER wichtigste Lauf im ganzen Plan. 4‚Äì4,5 Stunden. Dein Dress Rehearsal. Alles wird getestet. Versuche, einen Teil in der Dunkelheit zu laufen."},
    {date:"2026-03-08",day:"So",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Beine hoch.",detail:"Absolute Ruhe. Ab jetzt beginnt der Taper."},
  ]},
  {week:6,dateRange:"09.03 ‚Äì 15.03",goal:"Taper ‚Äî Frische aufbauen",days:[
    {date:"2026-03-09",day:"Mo",unit:"Gym ‚Äî Optional",dauer:"‚Äì",zone:"‚Äì",type:"gym",fokus:"Sehr leicht.",detail:"Gym ist jetzt optional. Wenn du gehst, dann ultra-leicht."},
    {date:"2026-03-10",day:"Di",unit:"Dauerlauf",dauer:"60 min",zone:"Zone 2",type:"run",fokus:"Locker.",detail:"Lockerer Dauerlauf. Volumen nimmt ab. Das ist normal und gewollt!"},
    {date:"2026-03-11",day:"Mi",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Erholung.",detail:"Pause. Genie√üe es."},
    {date:"2026-03-12",day:"Do",unit:"Tempolauf",dauer:"45 min",zone:"Zone 3",type:"tempo",fokus:"3√ó5 min z√ºgig.",detail:"Kurze, knackige Intervalle: 3√ó5 min in Zone 3. H√§lt dein System scharf."},
    {date:"2026-03-13",day:"Fr",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Regeneration.",detail:"Pause vor dem letzten langen Lauf."},
    {date:"2026-03-14",day:"Sa",unit:"Long Run",dauer:"3:00 h",zone:"Zone 2",type:"longrun",fokus:"Letzter l√§ngerer Lauf.",detail:"3 Stunden ‚Äî dein letzter langer Lauf vor dem Race. Genie√üe es."},
    {date:"2026-03-15",day:"So",unit:"Pause",dauer:"‚Äì",zone:"‚Äì",type:"rest",fokus:"Erholung.",detail:"Komplette Erholung."},
  ]},
  {week:7,dateRange:"16.03 ‚Äì 29.03",goal:"Frische & Wettkampf",days:[
    {date:"2026-03-17",day:"Mo",unit:"Lockerer Lauf",dauer:"45 min",zone:"Zone 2",type:"run",fokus:"Locker bleiben.",detail:"Nur locker bleiben. Dein K√∂rper ist jetzt bereit."},
    {date:"2026-03-19",day:"Mi",unit:"Lockerer Lauf",dauer:"30 min",zone:"Zone 2",type:"run",fokus:"3 Steigerungen am Ende.",detail:"30 min locker, dann 3 kurze Steigerungen (je 20 Sekunden)."},
    {date:"2026-03-21",day:"Fr",unit:"Shakeout Run",dauer:"20 min",zone:"Zone 2",type:"run",fokus:"Nur Bewegung.",detail:"20 Minuten. Einfach bewegen, Beine lockern. Tasche packen f√ºr England."},
    {date:"2026-03-29",day:"Sa",unit:"BACKYARD ULTRA",dauer:"24 STUNDEN",zone:"Zone 2",type:"race",fokus:"FINISH. Ruhig bleiben. Du schaffst das.",detail:"24 Stunden. 24 Runden. 160,8 km. Starte LANGSAM. Die ersten 6‚Äì8 Runden in unter 45 min, den Rest SITZEN und ESSEN. Iss ab Runde 1. Die letzten 6 Runden sind reine Willenskraft. Du hast daf√ºr trainiert."},
  ]},
];

const ALL_DAYS=PLAN.flatMap(w=>w.days.map(d=>({...d,week:w.week,weekGoal:w.goal,weekRange:w.dateRange})));
const TRAINING_DAYS=ALL_DAYS.filter(d=>d.type!=="race");

const TYPE_STYLES={
  run:{bg:"rgba(16,185,129,.08)",border:"1px solid rgba(16,185,129,.25)",text:"#34d399",label:"ZONE 2",dot:"#10b981"},
  longrun:{bg:"rgba(16,185,129,.1)",border:"1px solid rgba(16,185,129,.3)",text:"#6ee7b7",label:"LONG RUN",dot:"#34d399"},
  tempo:{bg:"rgba(245,158,11,.08)",border:"1px solid rgba(245,158,11,.25)",text:"#fbbf24",label:"TEMPO",dot:"#f59e0b"},
  gym:{bg:"rgba(59,130,246,.08)",border:"1px solid rgba(59,130,246,.25)",text:"#60a5fa",label:"GYM",dot:"#3b82f6"},
  rest:{bg:"rgba(139,92,246,.08)",border:"1px solid rgba(139,92,246,.25)",text:"#a78bfa",label:"PAUSE",dot:"#8b5cf6"},
  race:{bg:"rgba(239,68,68,.1)",border:"1px solid rgba(239,68,68,.3)",text:"#f87171",label:"RACE DAY",dot:"#ef4444"},
};

function getToday(){return new Date().toISOString().split("T")[0]}

function LoginScreen({onLogin}){
  const[pin,setPin]=useState("");const[error,setError]=useState(false);const[shaking,setShaking]=useState(false);
  function handleKey(n){
    if(n==="del"){setPin(p=>p.slice(0,-1));return}
    if(pin.length>=4)return;const next=pin+n;setPin(next);
    if(next.length===4){setTimeout(()=>{if(next===PASSWORD){localStorage.setItem("byu-auth","true");onLogin()}else{setError(true);setShaking(true);setPin("");setTimeout(()=>{setShaking(false);setError(false)},600)}},150)}
  }
  return(
    <div style={{minHeight:"100vh",background:"linear-gradient(135deg,#0a0a0a 0%,#1a1a2e 50%,#0a0a0a 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:20}}>
      <div className={shaking?"shake":""} style={{textAlign:"center"}}>
        <div style={{fontSize:64,marginBottom:8}}>üê∫</div>
        <h1 style={{fontFamily:"Georgia,serif",fontSize:22,letterSpacing:".15em",marginBottom:4}}>BACKYARD ULTRA</h1>
        <p style={{color:"#666",fontSize:12,letterSpacing:".2em",marginBottom:32}}>24H TRAINING TRACKER</p>
        <div style={{display:"flex",gap:12,justifyContent:"center",marginBottom:28}}>
          {[0,1,2,3].map(i=><div key={i} style={{width:16,height:16,borderRadius:"50%",border:"2px solid",borderColor:error?"#ef4444":i<pin.length?"#f97316":"#444",background:i<pin.length?"#f97316":"transparent",transition:"all .2s"}}/>)}
        </div>
        <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,maxWidth:240,margin:"0 auto"}}>
          {[1,2,3,4,5,6,7,8,9,null,0,"del"].map((n,i)=>n===null?<div key={i}/>:
            <button key={i} onClick={()=>handleKey(n)} style={{width:64,height:64,borderRadius:16,background:"rgba(255,255,255,.05)",border:"1px solid rgba(255,255,255,.08)",color:"#fff",fontSize:20,fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center"}}>{n==="del"?"‚å´":n}</button>
          )}
        </div>
        {error&&<p style={{color:"#ef4444",fontSize:13,marginTop:16}}>Falscher Code</p>}
      </div>
    </div>
  );
}

function ProgressRing({progress,size=90,stroke=6}){
  const r=(size-stroke)/2,circ=2*Math.PI*r,offset=circ-(progress/100)*circ;
  return(<svg width={size} height={size} style={{transform:"rotate(-90deg)"}}><circle cx={size/2} cy={size/2} r={r} fill="none" stroke="rgba(255,255,255,.06)" strokeWidth={stroke}/><circle cx={size/2} cy={size/2} r={r} fill="none" stroke="url(#pg)" strokeWidth={stroke} strokeDasharray={circ} strokeDashoffset={offset} strokeLinecap="round" style={{transition:"stroke-dashoffset 1s ease"}}/><defs><linearGradient id="pg" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stopColor="#f97316"/><stop offset="100%" stopColor="#ef4444"/></linearGradient></defs></svg>);
}

function DayCard({day,checked,onToggle,isToday,expanded,onExpand}){
  const s=TYPE_STYLES[day.type]||TYPE_STYLES.run;
  const d=new Date(day.date+"T00:00:00");
  const dayNum=d.getDate();const monthShort=d.toLocaleDateString("de-DE",{month:"short"});
  const today=getToday();const isPast=day.date<today&&!checked;
  return(
    <div className="card" onClick={onExpand} style={{borderRadius:16,border:s.border,background:s.bg,overflow:"hidden",boxShadow:isToday?"0 0 0 2px rgba(249,115,22,.4)":"none",opacity:checked?.55:1,marginBottom:10}}>
      <div style={{padding:16,display:"flex",alignItems:"flex-start",gap:16}}>
        <div style={{textAlign:"center",flexShrink:0,minWidth:48}}>
          <div style={{fontSize:26,fontWeight:700,color:isToday?"#f97316":"#fff"}}>{dayNum}</div>
          <div style={{fontSize:11,color:"#777",textTransform:"uppercase"}}>{monthShort}</div>
          {isToday&&<div style={{fontSize:10,color:"#f97316",fontWeight:700,marginTop:4,letterSpacing:".1em"}}>HEUTE</div>}
        </div>
        <div style={{flex:1,minWidth:0}}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:4,flexWrap:"wrap"}}>
            <span style={{fontSize:11,fontWeight:700,letterSpacing:".08em",color:s.text}}>{s.label}</span>
            {day.zone!=="‚Äì"&&<><span style={{color:"#555",fontSize:11}}>¬∑</span><span style={{color:"#999",fontSize:11}}>{day.zone}</span></>}
            {isPast&&<span style={{color:"rgba(239,68,68,.5)",fontSize:11,marginLeft:"auto"}}>verpasst?</span>}
          </div>
          <h3 style={{fontWeight:700,fontSize:17,color:checked?"#666":"#fff",textDecoration:checked?"line-through":"none",margin:0}}>{day.unit}</h3>
          <div style={{display:"flex",alignItems:"center",gap:10,marginTop:6,flexWrap:"wrap"}}>
            {day.dauer!=="‚Äì"&&<span style={{color:"#bbb",fontSize:13}}>{day.dauer}</span>}
            <span style={{color:"#666",fontSize:13}}>{day.fokus}</span>
          </div>
        </div>
        <button onClick={e=>{e.stopPropagation();onToggle()}} style={{width:42,height:42,borderRadius:12,flexShrink:0,border:checked?"2px solid #f97316":"2px solid #555",background:checked?"#f97316":"transparent",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:18,fontWeight:700,transition:"all .2s"}}>{checked?"‚úì":""}</button>
      </div>
      {expanded&&<div style={{padding:"0 16px 16px",borderTop:"1px solid rgba(255,255,255,.05)",marginTop:-2,paddingTop:14}}><p style={{color:"#ccc",fontSize:14,lineHeight:1.7}}>{day.detail}</p></div>}
    </div>
  );
}

function App(){
  const[authed,setAuthed]=useState(localStorage.getItem("byu-auth")==="true");
  const[checkedDays,setCheckedDays]=useState({});
  const[expandedDay,setExpandedDay]=useState(null);
  const[activeWeek,setActiveWeek]=useState(null);
  const[syncStatus,setSyncStatus]=useState("loading"); // loading, online, offline, syncing
  const[toast,setToast]=useState({msg:"",type:""});
  const saveTimeout=useRef(null);
  const today=getToday();

  function showToast(msg,type="success"){setToast({msg,type});setTimeout(()=>setToast({msg:"",type:""}),2500)}

  // Initial load: cloud first, then local fallback
  useEffect(()=>{
    (async()=>{
      const cloud=await cloudLoad();
      if(cloud!==null){
        setCheckedDays(cloud);
        localStorage.setItem("byu-checked",JSON.stringify(cloud));
        setSyncStatus("online");
      } else {
        const local=JSON.parse(localStorage.getItem("byu-checked")||"{}");
        setCheckedDays(local);
        setSyncStatus(FIREBASE_URL.includes("DEINE_FIREBASE")?"offline":"offline");
      }
      const cw=PLAN.find(w=>w.days.some(d=>d.date===today))?.week||PLAN.find(w=>w.days.some(d=>d.date>=today))?.week||PLAN[PLAN.length-1].week;
      setActiveWeek(cw);
    })();
  },[]);

  // Auto-refresh from cloud every 30s
  useEffect(()=>{
    if(FIREBASE_URL.includes("DEINE_FIREBASE"))return;
    const interval=setInterval(async()=>{
      const cloud=await cloudLoad();
      if(cloud){setCheckedDays(cloud);localStorage.setItem("byu-checked",JSON.stringify(cloud));setSyncStatus("online")}
    },30000);
    return()=>clearInterval(interval);
  },[]);

  function toggleDay(date){
    const next={...checkedDays};
    next[date]=!next[date];if(!next[date])delete next[date];
    setCheckedDays(next);
    localStorage.setItem("byu-checked",JSON.stringify(next));

    // Debounced cloud save
    setSyncStatus("syncing");
    if(saveTimeout.current)clearTimeout(saveTimeout.current);
    saveTimeout.current=setTimeout(async()=>{
      const ok=await cloudSave(next);
      setSyncStatus(ok?"online":"offline");
      if(!ok&&!FIREBASE_URL.includes("DEINE_FIREBASE"))showToast("Offline ‚Äî lokal gespeichert","error");
    },500);
  }

  if(!authed)return <LoginScreen onLogin={()=>setAuthed(true)}/>;

  const totalTraining=TRAINING_DAYS.length;
  const checkedCount=TRAINING_DAYS.filter(d=>checkedDays[d.date]).length;
  const progress=Math.round((checkedCount/totalTraining)*100);
  const todayEntry=ALL_DAYS.find(d=>d.date===today);
  const upcoming=ALL_DAYS.filter(d=>d.date>today).slice(0,3);
  const raceDate=new Date("2026-03-29T00:00:00");
  const todayDate=new Date(today+"T00:00:00");
  const daysUntilRace=Math.max(0,Math.ceil((raceDate-todayDate)/(1000*60*60*24)));

  return(
    <div style={{minHeight:"100vh",background:"linear-gradient(180deg,#0a0a0a 0%,#111118 100%)",paddingBottom:40}}>
      <div className={`toast ${toast.msg?"show":""} ${toast.type}`}>{toast.msg}</div>

      {/* Header */}
      <div style={{background:"linear-gradient(135deg,rgba(249,115,22,.12) 0%,rgba(239,68,68,.06) 100%)",borderBottom:"1px solid rgba(255,255,255,.05)"}}>
        <div style={{maxWidth:640,margin:"0 auto",padding:24}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:24}}>
            <div>
              <div style={{display:"flex",alignItems:"center",gap:10}}>
                <h1 style={{fontSize:24,fontWeight:700,fontFamily:"Georgia,serif",margin:0}}>BACKYARD ULTRA</h1>
                <div className={`sync-dot ${syncStatus}`} title={syncStatus==="online"?"Cloud sync aktiv":syncStatus==="syncing"?"Synchronisiert...":"Offline"}/>
              </div>
              <p style={{color:"#777",fontSize:13,margin:"4px 0 0"}}>Lone Wolf SE ¬∑ 29. M√§rz 2026</p>
            </div>
            <div style={{textAlign:"right"}}>
              <div style={{fontSize:32,fontWeight:700,color:"#f97316"}}>{daysUntilRace}</div>
              <div style={{color:"#777",fontSize:10,letterSpacing:".15em"}}>TAGE BIS RACE</div>
            </div>
          </div>
          <div style={{display:"flex",alignItems:"center",gap:24}}>
            <div style={{position:"relative",flexShrink:0}}>
              <ProgressRing progress={progress}/>
              <div style={{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"}}><span style={{fontSize:20,fontWeight:700}}>{progress}%</span></div>
            </div>
            <div style={{flex:1}}>
              <div style={{display:"flex",justifyContent:"space-between",fontSize:13,marginBottom:8}}>
                <span style={{color:"#999"}}>Training</span>
                <span style={{color:"#666"}}>{checkedCount}/{totalTraining}</span>
              </div>
              <div style={{height:8,background:"rgba(255,255,255,.05)",borderRadius:4,overflow:"hidden"}}>
                <div style={{height:"100%",borderRadius:4,background:"linear-gradient(90deg,#f97316,#ef4444)",width:`${progress}%`,transition:"width 1s ease"}}/>
              </div>
              <div style={{display:"flex",gap:12,marginTop:12,flexWrap:"wrap"}}>
                {Object.entries(TYPE_STYLES).map(([k,v])=><div key={k} style={{display:"flex",alignItems:"center",gap:5}}><div style={{width:7,height:7,borderRadius:"50%",background:v.dot}}/><span style={{color:"#666",fontSize:10}}>{v.label}</span></div>)}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div style={{maxWidth:640,margin:"0 auto",padding:"0 20px"}}>
        {todayEntry&&(<div style={{paddingTop:24}}>
          <h2 style={{fontSize:11,fontWeight:700,color:"#f97316",letterSpacing:".15em",marginBottom:12}}>HEUTE ‚Äî {new Date(today+"T00:00:00").toLocaleDateString("de-DE",{weekday:"long",day:"numeric",month:"long"})}</h2>
          <DayCard day={todayEntry} checked={!!checkedDays[todayEntry.date]} onToggle={()=>toggleDay(todayEntry.date)} isToday={true} expanded={expandedDay===todayEntry.date} onExpand={()=>setExpandedDay(expandedDay===todayEntry.date?null:todayEntry.date)}/>
        </div>)}

        {upcoming.length>0&&(<div style={{paddingTop:24}}>
          <h2 style={{fontSize:11,fontWeight:700,color:"#666",letterSpacing:".15em",marginBottom:12}}>N√ÑCHSTE EINHEITEN</h2>
          {upcoming.map(d=><DayCard key={d.date} day={d} checked={!!checkedDays[d.date]} onToggle={()=>toggleDay(d.date)} isToday={false} expanded={expandedDay===d.date} onExpand={()=>setExpandedDay(expandedDay===d.date?null:d.date)}/>)}
        </div>)}

        <div style={{paddingTop:32}}>
          <h2 style={{fontSize:11,fontWeight:700,color:"#666",letterSpacing:".15em",marginBottom:12}}>WOCHEN</h2>
          <div style={{display:"flex",gap:8,overflowX:"auto",paddingBottom:8}}>
            {PLAN.map(w=>{
              const wc=w.days.filter(d=>checkedDays[d.date]).length;
              const isActive=activeWeek===w.week;const isCurrent=w.days.some(d=>d.date===today);
              return(<button key={w.week} onClick={()=>setActiveWeek(w.week)} style={{flexShrink:0,padding:"10px 16px",borderRadius:12,border:isActive?"1px solid rgba(249,115,22,.4)":"1px solid rgba(255,255,255,.05)",background:isActive?"rgba(249,115,22,.12)":"rgba(255,255,255,.02)",color:isActive?"#f97316":"#888",textAlign:"center"}}>
                <div style={{fontSize:12,fontWeight:700}}>W{w.week}</div>
                <div style={{fontSize:10,opacity:.6,marginTop:2}}>{wc}/{w.days.length}</div>
                {isCurrent&&<div style={{width:6,height:6,borderRadius:"50%",background:"#f97316",margin:"4px auto 0"}}/>}
              </button>);
            })}
          </div>
        </div>

        {activeWeek&&(()=>{const w=PLAN.find(w=>w.week===activeWeek);if(!w)return null;return(
          <div style={{paddingTop:16}}>
            <h3 style={{fontSize:18,fontWeight:700,margin:0}}>Woche {w.week} <span style={{color:"#666",fontWeight:400,fontSize:14}}>¬∑ {w.dateRange}</span></h3>
            <p style={{color:"rgba(249,115,22,.7)",fontSize:13,marginTop:4,marginBottom:16}}>{w.goal}</p>
            {w.days.map(d=><DayCard key={d.date} day={d} checked={!!checkedDays[d.date]} onToggle={()=>toggleDay(d.date)} isToday={d.date===today} expanded={expandedDay===d.date} onExpand={()=>setExpandedDay(expandedDay===d.date?null:d.date)}/>)}
          </div>
        );})()}
      </div>
    </div>
  );
}
ReactDOM.render(<App/>,document.getElementById("root"));
</script>
</body>
</html>
